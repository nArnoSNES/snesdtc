<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PVSnesLib: games/likemario/LikeMario.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PVSnesLib
   &#160;<span id="projectnumber">2.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">games/likemario/LikeMario.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*---------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    Simple tile mode 1 with scrolling demo</span></div><div class="line"><span class="comment">    -- alekmaul</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">---------------------------------------------------------------------------------*/</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00419.html">snes.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;soundbank.h&quot;</span></div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">char</span> __SOUNDBANK__;</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">char</span> jumpsnd,jumpsndend;</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">char</span> mapgfx, mapgfx_end;</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">char</span> mappal;</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">char</span> map;</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">char</span> mariogfx, mariogfx_end;</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">char</span> mariopal;</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">char</span> mapcol;</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">char</span> snesfont;</div><div class="line"></div><div class="line"><span class="comment">// Mario sprite</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, y;</div><div class="line">    <span class="keywordtype">int</span> jmpval;</div><div class="line">    <span class="keywordtype">int</span> anim_frame;</div><div class="line">    <span class="keywordtype">int</span> flipx;</div><div class="line">} Mario;</div><div class="line"></div><div class="line"><span class="comment">// Mario tiles</span></div><div class="line"><span class="keyword">enum</span> {MARIODOWN = 0, MARIOJUMPING = 1, MARIOWALK = 2, MARIOSTAND = 6};</div><div class="line"></div><div class="line"><span class="preprocessor">#define GRAVITY 48</span></div><div class="line"><span class="preprocessor">#define JUMPVALUE (GRAVITY*20)</span></div><div class="line"></div><div class="line"><span class="keyword">enum</span> MarioState {W_JUMP = 1, W_RIGHT = 2,  W_LEFT = 3};</div><div class="line"></div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> scrX=0, idxScr=0, idFlip=0;  <span class="comment">// for screen scrolling</span></div><div class="line">Mario mario;   <span class="comment">// Our hero :D !</span></div><div class="line"></div><div class="line"><a name="_a0"></a><a class="code" href="a00445.html">brrsamples</a> Jump; <span class="comment">// The sound for jumping</span></div><div class="line"></div><div class="line"><span class="comment">//---------------------------------------------------------------------------------</span></div><div class="line">u16 getCollisionTile(u16 x, u16 y) {</div><div class="line">    u16 *ptrMap = (u16 *) &amp;mapcol + (y&gt;&gt;3)*300 + (x&gt;&gt;3);</div><div class="line">    </div><div class="line">    <span class="keywordflow">return</span> (*ptrMap);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//---------------------------------------------------------------------------------</span></div><div class="line"><span class="keywordtype">void</span> moveLevel(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> direction) {</div><div class="line">    <span class="keywordtype">int</span> i;</div><div class="line">    u16 *ptrMap;</div><div class="line">    u16 ptrVRAM; </div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sx;</div><div class="line">    </div><div class="line">    <a name="a1"></a><a class="code" href="a00416.html#a09d7fb089889aaa434f7c88ebccb5190">REG_VMAIN</a> = VRAM_INCHIGH | <a name="a2"></a><a class="code" href="a00416.html#a5623bfd6fefb79d4f21d260b7e333523acbbc69e337e06fc13a5f572284c5ddfe">VRAM_ADRTR_0B</a> | <a name="a3"></a><a class="code" href="a00416.html#a5623bfd6fefb79d4f21d260b7e333523acfee058cf30c9aacc05573725e3775d8">VRAM_ADRSTINC_1</a>; <span class="comment">// set address in VRam for read or write ($2116) + block size transfer ($2115)</span></div><div class="line">    <a name="a4"></a><a class="code" href="a00416.html#a962038681293a309df2c26f1e9a7d7e9">REG_VMADDLH</a> = 0x1000;</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (direction == W_RIGHT) {</div><div class="line">        scrX++; </div><div class="line">        <span class="keywordflow">if</span> ( (scrX &amp;7) == 0) { <span class="comment">// to avoid to bee too slow</span></div><div class="line">            <span class="comment">//*(unsigned char *) 0x2115 = 0x80;</span></div><div class="line">            sx = (scrX&gt;&gt;3) &amp; 63;</div><div class="line">            sx = (sx + 32);</div><div class="line">            <span class="keywordflow">if</span> (sx&gt;63) </div><div class="line">                sx = sx - 64;</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">                sx = (sx-32) + 32*32;</div><div class="line">            ptrVRAM = 0x1000 + sx; <span class="comment">// screen begin to 0x1000</span></div><div class="line">            ptrMap  = (u16 *)  &amp;map + (scrX &gt;&gt; 3) + 32; </div><div class="line">            <span class="comment">// Copy the line in the background but need to wait VBL period</span></div><div class="line">            <a name="a5"></a><a class="code" href="a00389.html#a03304aaf535795c2857e357e028cdebe">WaitVBLFlag</a>;</div><div class="line">            <span class="keywordflow">for</span> (i=0;i&lt;16;i++) {</div><div class="line">                u16 value = *ptrMap;</div><div class="line">                <a class="code" href="a00416.html#a962038681293a309df2c26f1e9a7d7e9">REG_VMADDLH</a> = ptrVRAM;</div><div class="line">                <a name="a6"></a><a class="code" href="a00416.html#a2e1221b6655ab3ef51d4e0e465990e92">REG_VMDATALH</a> = value ;</div><div class="line">                ptrVRAM += 32;</div><div class="line">                ptrMap += 300;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="comment">// scroll to the left</span></div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        scrX--; </div><div class="line">        <span class="keywordflow">if</span> ( (scrX &amp;7) == 0) { <span class="comment">// to avoid to bee too slow</span></div><div class="line">            <span class="keywordflow">if</span> (scrX) { <span class="comment">// to avoid doing some for 1st tile </span></div><div class="line">                <span class="comment">//*(unsigned char *) 0x2115 = 0x80;</span></div><div class="line">                sx = (scrX&gt;&gt;3) &amp; 63;</div><div class="line">                sx = (sx - 1);</div><div class="line">                <span class="keywordflow">if</span> (sx&lt;0) sx = sx + 64;</div><div class="line">                <span class="keywordflow">if</span> (sx&gt;31) sx = (sx-32) + 32*32;</div><div class="line">                ptrVRAM = 0x1000 + sx; <span class="comment">// screen begin to 0x1000</span></div><div class="line">                ptrMap  = (u16 *)  &amp;map + (scrX &gt;&gt; 3) - 1; </div><div class="line">                <span class="comment">// Copy the line in the background but need to wait VBL period</span></div><div class="line">                <a class="code" href="a00389.html#a03304aaf535795c2857e357e028cdebe">WaitVBLFlag</a>;</div><div class="line">                <span class="keywordflow">for</span> (i=0;i&lt;16;i++) {</div><div class="line">                    u16 value = *ptrMap;</div><div class="line">                    <a class="code" href="a00416.html#a962038681293a309df2c26f1e9a7d7e9">REG_VMADDLH</a> = ptrVRAM;</div><div class="line">                    <a class="code" href="a00416.html#a2e1221b6655ab3ef51d4e0e465990e92">REG_VMDATALH</a> = value ;</div><div class="line">                    ptrVRAM += 32;</div><div class="line">                    ptrMap += 300;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// now scroll with current value</span></div><div class="line">    <a name="a7"></a><a class="code" href="a00380.html#aa5e0112ea2d4b514c2dddc6ed2c7c3c7">bgSetScroll</a>(1,scrX,0);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//---------------------------------------------------------------------------------</span></div><div class="line"><span class="keywordtype">void</span> moveMario(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> padvalue) {</div><div class="line">    <span class="comment">// Update scrolling with current pad (left / right / jump can combine)</span></div><div class="line">    <span class="keywordflow">if</span> (padvalue &amp; (<a name="a8"></a><a class="code" href="a00398.html#aa27cad8fa018a58930b6622783a83072a6504370d9c6391e1a9da6a1a529b089d">KEY_RIGHT</a> | <a name="a9"></a><a class="code" href="a00398.html#aa27cad8fa018a58930b6622783a83072a612120b69c7dfd46086db7aaebdbcf65">KEY_LEFT</a> | <a name="a10"></a><a class="code" href="a00398.html#aa27cad8fa018a58930b6622783a83072aa7b3a3d0503a46bec51c6e3da95747cc">KEY_A</a>) ) {</div><div class="line">        <span class="keywordflow">if</span> (padvalue &amp; <a class="code" href="a00398.html#aa27cad8fa018a58930b6622783a83072a6504370d9c6391e1a9da6a1a529b089d">KEY_RIGHT</a>) { </div><div class="line">            <span class="comment">// if we can go right</span></div><div class="line">            <span class="keywordflow">if</span> (getCollisionTile(scrX+(mario.x&gt;&gt;8)+16, (mario.y&gt;&gt;8)) == 0) {</div><div class="line">                <span class="comment">// if when are less than screen center, let&#39;s go</span></div><div class="line">                <span class="keywordflow">if</span> (mario.x&lt;(128&lt;&lt;8)) { <span class="comment">// If mario coord is not center</span></div><div class="line">                    mario.x+=256;</div><div class="line">                }</div><div class="line">                <span class="comment">// else if screen can scroll (width minus one screen)</span></div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (scrX&lt;(300*8-32*8)) {</div><div class="line">                    moveLevel(W_RIGHT);</div><div class="line">                }</div><div class="line">                <span class="comment">// else, can go if not on right of screen</span></div><div class="line">                <span class="keywordflow">else</span>  {</div><div class="line">                    <span class="keywordflow">if</span> (mario.x&lt;(255&lt;&lt;8)) mario.x+=256;</div><div class="line">                }</div><div class="line">                mario.flipx=1;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="comment">// Else it&#39;s perhaps left :)</span></div><div class="line">        <span class="keywordflow">if</span> (padvalue &amp; <a class="code" href="a00398.html#aa27cad8fa018a58930b6622783a83072a612120b69c7dfd46086db7aaebdbcf65">KEY_LEFT</a>)  {</div><div class="line">            <span class="comment">// can we go left ?</span></div><div class="line">            <span class="keywordflow">if</span> ((scrX+(mario.x&gt;&gt;8)-1&gt;0) &amp;&amp; (getCollisionTile(scrX+(mario.x&gt;&gt;8)-1, (mario.y&gt;&gt;8)) == 0)) { </div><div class="line">                <span class="comment">// if we are on the right of the screen, go to center</span></div><div class="line">                <span class="keywordflow">if</span> (mario.x&gt;(128&lt;&lt;8)) {</div><div class="line">                    mario.x-=256;</div><div class="line">                }</div><div class="line">                <span class="comment">// else if screen can scroll</span></div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (scrX&gt;0) {</div><div class="line">                    moveLevel(W_LEFT);</div><div class="line">                }</div><div class="line">                <span class="comment">// else, can go if not on mleft of screen</span></div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mario.x&gt;(0&lt;&lt;8)) {</div><div class="line">                    mario.x-=256;</div><div class="line">                }</div><div class="line">                mario.flipx=0;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="comment">// Hum, no perhaps jumping \o/</span></div><div class="line">        <span class="keywordflow">if</span> (padvalue &amp; <a class="code" href="a00398.html#aa27cad8fa018a58930b6622783a83072aa7b3a3d0503a46bec51c6e3da95747cc">KEY_A</a>) {</div><div class="line">            <span class="comment">// can jump ??</span></div><div class="line">            <span class="keywordflow">if</span> (getCollisionTile(scrX+(mario.x&gt;&gt;8), (mario.y&gt;&gt;8)+16) != 0) {</div><div class="line">                mario.jmpval = -JUMPVALUE;</div><div class="line">                mario.anim_frame = MARIOJUMPING;</div><div class="line">                <a name="a11"></a><a class="code" href="a00410.html#a8e5286554841ea48b028b4b782364ab0">spcPlaySound</a>(0);</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Update frame if not jumping</span></div><div class="line">        <span class="keywordflow">if</span> (mario.anim_frame != MARIOJUMPING) {</div><div class="line">            <span class="keywordflow">if</span> ((mario.anim_frame&lt;MARIOWALK) || (mario.anim_frame == MARIOSTAND)) {</div><div class="line">                mario.anim_frame = MARIOWALK;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> {</div><div class="line">                mario.anim_frame++;</div><div class="line">                <span class="keywordflow">if</span>(mario.anim_frame &gt;= MARIOSTAND) mario.anim_frame = MARIOWALK;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="comment">// down to have small mario</span></div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (padvalue &amp; <a name="a12"></a><a class="code" href="a00398.html#aa27cad8fa018a58930b6622783a83072aa9cdac7967bf7d88fdb761138a2a3416">KEY_DOWN</a>) {</div><div class="line">        mario.anim_frame = MARIODOWN;</div><div class="line">    }</div><div class="line">    <span class="comment">// well, no pad value, so just standing !</span></div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        <span class="keywordflow">if</span> (mario.anim_frame != MARIOJUMPING) mario.anim_frame = MARIOSTAND;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// if can jump, just do it !</span></div><div class="line">    <span class="keywordflow">if</span> (getCollisionTile((scrX+(mario.x&gt;&gt;8)+8), ((mario.y&gt;&gt;8)+16)) == 0) {</div><div class="line">        mario.jmpval += GRAVITY;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Add jumping value if needed</span></div><div class="line">    mario.y += mario.jmpval;</div><div class="line">    </div><div class="line">    <span class="comment">// Again test collsion with ground</span></div><div class="line">    <span class="keywordflow">if</span> (getCollisionTile((scrX+(mario.x&gt;&gt;8)+8), ((mario.y&gt;&gt;8)+16)) != 0) {</div><div class="line">        <span class="keywordflow">if</span> (mario.jmpval) {</div><div class="line">            mario.jmpval = 0;</div><div class="line">            mario.anim_frame = MARIOSTAND;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="comment">// To avoid being in floor</span></div><div class="line">    <span class="keywordflow">while</span> (getCollisionTile((scrX+(mario.x&gt;&gt;8)+8), ((mario.y&gt;&gt;8)+15))) {</div><div class="line">        mario.y -= 128; </div><div class="line">        mario.jmpval = 0;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//---------------------------------------------------------------------------------</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pad0, move, i;</div><div class="line"></div><div class="line">    <span class="comment">// Initialize sound engine (take some time)</span></div><div class="line">    <a name="a13"></a><a class="code" href="a00410.html#ad8753cb6edb38834257bbf0020700689">spcBoot</a>();</div><div class="line">    </div><div class="line">    <span class="comment">// Initialize SNES </span></div><div class="line">    <a name="a14"></a><a class="code" href="a00383.html#a6047713bb5a73afd3cd1d77e336bcdad">consoleInit</a>();</div><div class="line">    </div><div class="line">    <span class="comment">// Set give soundbank</span></div><div class="line">    <a name="a15"></a><a class="code" href="a00410.html#ab68840ba8aab786b8ea206ea077acaac">spcSetBank</a>(&amp;__SOUNDBANK__);</div><div class="line">    </div><div class="line">    <span class="comment">// allocate around 10K of sound ram (39 256-byte blocks)</span></div><div class="line">    <a name="a16"></a><a class="code" href="a00410.html#a2113060be24b307d1e03f167eb241b90">spcAllocateSoundRegion</a>(39);</div><div class="line"></div><div class="line">    <span class="comment">// Load music</span></div><div class="line">    <a name="a17"></a><a class="code" href="a00410.html#a313e30fb1962df9fb469f2fedd4d91e4">spcLoad</a>(MOD_OVERWORLD);</div><div class="line">    </div><div class="line">    <span class="comment">// Load sample</span></div><div class="line">    <a name="a18"></a><a class="code" href="a00410.html#a4ef9d5d4b7618a2e091194b6c17f75a5">spcSetSoundEntry</a>(15, 8, 6, &amp;jumpsndend-&amp;jumpsnd, &amp;jumpsnd, &amp;Jump);</div><div class="line">    </div><div class="line">    <span class="comment">// Initialize text console with our font and invert color (black with BG white)</span></div><div class="line">    <a name="a19"></a><a class="code" href="a00383.html#a458fa049800e12429ca0ba401e513746">consoleInitText</a>(0, 1, &amp;snesfont);</div><div class="line">    <a name="a20"></a><a class="code" href="a00383.html#ac0993a72682f86d17784a7f4659562de">consoleSetTextCol</a>(<a name="a21"></a><a class="code" href="a00416.html#abd4530c7880d389c9ea70e2e3b84aa9d">RGB15</a>(0,0,0), <a class="code" href="a00416.html#abd4530c7880d389c9ea70e2e3b84aa9d">RGB15</a>(31,31,31));</div><div class="line">    </div><div class="line">    <span class="comment">// Copy tiles to VRAM</span></div><div class="line">    <a name="a22"></a><a class="code" href="a00380.html#ae09a7ac09be78eef0f28a6c7aabc82ad">bgInitTileSet</a>(1, &amp;mapgfx, &amp;mappal, 0, (&amp;mapgfx_end - &amp;mapgfx), 16*2, BG_16COLORS, 0x6000);</div><div class="line"></div><div class="line">    <span class="comment">// Init Sprites gfx and palette with default size of 16x16</span></div><div class="line">    <a name="a23"></a><a class="code" href="a00413.html#a46e0be47f8fc865a7f43c1b0b126e59a">oamInitGfxSet</a>(&amp;mariogfx, (&amp;mariogfx_end-&amp;mariogfx), &amp;mariopal, 16*2, 0, 0x4000, <a name="a24"></a><a class="code" href="a00413.html#a35664c2c4a66c3bac8139ae093d7f3ac">OBJ_SIZE16</a>);</div><div class="line"></div><div class="line">    <span class="comment">// Init Map to address 0x1000 and Copy Map to VRAM</span></div><div class="line">    <a name="a25"></a><a class="code" href="a00380.html#a4fcbdb4b2378a64e8db62a184ee1851e">bgSetMapPtr</a>(1, 0x1000, <a name="a26"></a><a class="code" href="a00380.html#a6129b86a7c2913a31f1bca293fa7c1e7">SC_64x32</a>);</div><div class="line">    <span class="keywordflow">for</span> (i=0;i&lt;31;i++) { <span class="comment">// 128 pixel height -&gt; 128/8 = 16 2400 / 8 = 300</span></div><div class="line">        u8 *ptrMap  = &amp;map + 300*i*2; <span class="comment">// 300 = map size x *2 because each entry is 16bits length</span></div><div class="line">        <span class="keywordflow">if</span> (i&gt;=16) ptrMap  = &amp;map + 300*5*2; <span class="comment">// Init anything else with white line</span></div><div class="line">        u16 ptrVRAM = 0x1000+i*32; <span class="comment">// screen begin to 0x1000</span></div><div class="line">        <a name="a27"></a><a class="code" href="a00386.html#aaf545b3f811f6ef4b7c4be434701a77a">dmaCopyVram</a>(ptrMap, ptrVRAM, 32*2); <span class="comment">// copy row to VRAM </span></div><div class="line">        <a class="code" href="a00386.html#aaf545b3f811f6ef4b7c4be434701a77a">dmaCopyVram</a>((ptrMap+32*2), (ptrVRAM+32*32), 32*2); <span class="comment">// copy row to VRAM </span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Show Mario</span></div><div class="line">    mario.x = 32&lt;&lt;8; mario.y = 96&lt;&lt;8; <span class="comment">// 128-16-16 = 96, 16 because map ground is 16 pix height, in fixed point</span></div><div class="line">    mario.anim_frame = MARIOSTAND; mario.flipx = 1; mario.jmpval = 0;</div><div class="line">    <a name="a28"></a><a class="code" href="a00413.html#a2f62a591672b786d90ebb03fdf25f159">oamSet</a>(0,  (mario.x&gt;&gt;8), (mario.y&gt;&gt;8), 3, mario.flipx, 0, mario.anim_frame*2, 0);  <span class="comment">// flip x and take 5th sprite</span></div><div class="line">    <a name="a29"></a><a class="code" href="a00413.html#a4120a8ff32c39973babeca3615a0a2fd">oamSetEx</a>(0, OBJ_SMALL, OBJ_SHOW);</div><div class="line">    </div><div class="line">    <span class="comment">// Now Put in 16 color mode and disable BG3</span></div><div class="line">    <a name="a30"></a><a class="code" href="a00416.html#afd9e46ae627d055dd8c98a4b0ebb73b1">setMode</a>(<a name="a31"></a><a class="code" href="a00380.html#a05c862edb7f8f75036f10c04dcc3c2a6">BG_MODE1</a>,0);  <a name="a32"></a><a class="code" href="a00380.html#a4dbfb1b8854ff9ca4a7d11a899281bbb">bgSetDisable</a>(2);</div><div class="line">    </div><div class="line">    <span class="comment">// Put some text</span></div><div class="line">    <a name="a33"></a><a class="code" href="a00383.html#a7e52d15b5a1befa42f5758de19dfb70c">consoleDrawText</a>(6,16,<span class="stringliteral">&quot;MARIOx00  WORLD TIME&quot;</span>);</div><div class="line">    <a class="code" href="a00383.html#a7e52d15b5a1befa42f5758de19dfb70c">consoleDrawText</a>(6,17,<span class="stringliteral">&quot; 00000 ox00 1-1  000&quot;</span>);</div><div class="line">    </div><div class="line">    <span class="comment">// Put screen on</span></div><div class="line">    <a name="a34"></a><a class="code" href="a00416.html#abc7d4ef8ebc22f5b710927909bb3f144">setScreenOn</a>();</div><div class="line">    </div><div class="line">    <span class="comment">// Play file from the beginning</span></div><div class="line">    <a name="a35"></a><a class="code" href="a00410.html#aebf91de1df5e4fa83454a84bb0e60918">spcPlay</a>(0);<a name="a36"></a><a class="code" href="a00410.html#ae2c8dfab62ceecf5c302c95f5453a752">spcSetModuleVolume</a>(100);</div><div class="line">    </div><div class="line">    <span class="comment">// Wait VBL &#39;and update sprites too ;-) )</span></div><div class="line">    <a name="a37"></a><a class="code" href="a00389.html#a815e2626bd26d0e936d507a363ecd723">WaitForVBlank</a>();</div><div class="line">    </div><div class="line">    <span class="comment">// Wait for nothing :P</span></div><div class="line">    <span class="keywordflow">while</span>(1) {</div><div class="line">        <span class="comment">// no move currently</span></div><div class="line">        move = 0;</div><div class="line">        </div><div class="line">        <span class="comment">// Refresh pad values</span></div><div class="line">        <a name="a38"></a><a class="code" href="a00398.html#a42632e79292dc47a567aab4dc3e4407d">scanPads</a>();</div><div class="line">        </div><div class="line">        <span class="comment">// Get current #0 pad</span></div><div class="line">        pad0 = <a name="a39"></a><a class="code" href="a00398.html#a6063e0eec9a36e437fc32951acafa44c">padsCurrent</a>(0);</div><div class="line">        </div><div class="line">        <span class="comment">// update mario regarding pad value</span></div><div class="line">        moveMario(pad0);</div><div class="line">        </div><div class="line">        <span class="comment">// Now, display mario with current animation</span></div><div class="line">        <a class="code" href="a00413.html#a2f62a591672b786d90ebb03fdf25f159">oamSet</a>(0,  (mario.x&gt;&gt;8), (mario.y&gt;&gt;8), 3, mario.flipx, 0, mario.anim_frame*2, 0);</div><div class="line">        </div><div class="line">        <span class="comment">// Update sound and wait VBL</span></div><div class="line">        <a name="a40"></a><a class="code" href="a00410.html#acab7d87110bac6baa9d74ab314772c98">spcProcess</a>();</div><div class="line">        <a class="code" href="a00389.html#a815e2626bd26d0e936d507a363ecd723">WaitForVBlank</a>();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
